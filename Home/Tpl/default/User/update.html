<include file="Public:header" />
<link rel="stylesheet" type="text/css" href="__ROOT__/default/css/register.css" media="screen" />
<link rel="stylesheet" type="text/css" href="__ROOT__/default/css/update.css" media="screen" />
<script type="text/javascript">
var chg=-1;
$(document).ready(function(){
	$(".pwc").click(function(){
		$(".new_p").css("display", "table-row");
		$(".new_u").css("display", "none");
		chg=0;
	});
	$(".ctc").click(function(){
		$(".new_p").css("display", "none");
		$(".new_u").css("display", "table-row");
		chg=1;
	});
});
function ajax_register()
{
    /** 信息窗 */
    $("#error-tip #error-loading").css("display", "block");
    $("#error-tip #error-message").html("不明物体祈祷中...");
    $("#error-tip").slideDown("normal");

    var oldpw = $("input[name=oldpw]").val();
    var newpw = $("input[name=newpw]").val();
    var nickname = $("input[name=nickname]").val();
    var email = $("input[name=email]").val();
    var school = $("input[name=school]").val();
    var motto = $("textarea[name=motto]").val();
    var token = $("input[name={:C('TOKEN_NAME')}]").val();

    $.post("{:U('User/updates')}", {
        "oldpw": oldpw,
        "newpw": newpw,
        "nickname": nickname,
        "email": email,
        "school": school,
        "motto": motto,
        "chg": chg,
		"{:C('TOKEN_NAME')}": token
    }, function(html){
        $("#error-tip #error-loading").css("display", "none");
        
        if(html != "1")
        {
            $("#error-tip #error-message").html(html);
        }
        else
        {
            $("#error-tip #error-message").html("抱团成功，正在转向...");
            window.location.href = "__ROOT__/";
        }
    });
}

$(function(){
    $("#reg-submit").click(function(){
        ajax_register();
    });

    $("#register-table input").keypress(function(e){
        if(e.keyCode == 13) ajax_register();
    });
});
</script>

<div id="register-wrapper">
    <h1>用户修改</h1>
    <table id="register-table">
		<tr class="new_1"><td class="pwc">修改密码</td><td class="ctc">修改资料</td></tr>
        <tr class="new_p">
            <td class="reg-title"><span class="reg-tip"></span> 旧密码</td>
            <td class="reg-input-td"><input type="password" name="oldpw" /></td>
        </tr>
        <tr class="new_p">
            <td class="reg-title"><span class="reg-tip"></span> 新密码</td>
            <td class="reg-input-td"><input type="password" name="newpw" /></td>
        </tr>
        <tr class="new_u">
            <td class="reg-title"><span class="reg-tip"></span> 昵　称</td>
            <td class="reg-input-td"><input type="text" name="nickname" value="{$list[0]['nickname']}" /></td>
        </tr>
        <tr class="new_u">
            <td class="reg-title"><span class="reg-tip"></span> 邮　箱</td>
            <td class="reg-input-td"><input type="text" name="email" value="{$list[0]['email']}" /></td>
        </tr>
        <tr class="new_u">
            <td class="reg-title">学　校</td>
            <td class="reg-input-td"><input type="text" name="school" value="{$list[0]['school']}" /></td>
        </tr>
        <tr class="new_u">
            <td style="vertical-align: top;" class="reg-title">格　言</td>
            <td class="reg-input-td">
                <textarea rows="10" name="motto" cols="30">{$list[0]['motto']}</textarea>
            </td>
        </tr>
        <tr>
            <td class="reg-title">确认修改</td>
            <td class="reg-input-td">
                <div id="error-tip">
                    <div class="fl">　</div>
                    <div class="fl" id="error-loading"><img src="__ROOT__/default/images/loading.gif" /></div>
                    <div class="fl" id="error-message">不明物体祈祷中...</div>
                    <div class="cl"></div>
                </div>

                <input id="reg-submit" type="submit" value=">>>>" />
            </td>
        </tr>
    </table>
    {__TOKEN__}
</div>

<include file="Public:footer" />