<include file="Public:header" />
    <script type="text/javascript" src="__ROOT__/keditor/kindeditor-min.js"></script>
    <script type="text/javascript" src="__ROOT__/keditor/lang/zh_CN.js"></script>

    <div class="content-box">
        <div class="content-box-header">
            <h3>添加新题</h3>
        </div>

        <div class="content-box-content">
            <form>
                <fieldset>
                    <p>
                        <label>题目标题</label>
                        <input class="text-input small-input" type="text" id="title" name="title" /><br />
                    </p>

                    <p>
                        <label>时间限制</label>
                        <input class="text-input small-input" value="1000" type="text" id="timelimit" name="timelimit" /> 毫秒<br />
                    </p>

                    <p>
                        <label>内存限制</label>
                        <input class="text-input small-input" value="65535" type="text" id="memorylimit" name="memorylimit" /> kb<br />
                    </p>

                    <!--<p>
                        <label>题目描述</label>
                        <textarea id="description"> </textarea><br />

                        <script type="text/javascript">
                        var editor = new baidu.editor.ui.Editor({
                            UEDITOR_HOME_URL: '{$HC.webroot}/ueditor/',
                            iframeCssUrl :'{$HC.webroot}/ueditor/themes/default/iframe.css',
                            textarea: "description"
                        });
                        editor.render('description');
                        </script>
                    </p>-->
                    <p>
                        <label>题目描述</label>
                        <textarea style="height: 400px;" name="description" id="description"></textarea>
                        
                        <script type="text/javascript">
                        var editor;
                        $(function(){
                            editor = KindEditor.create("#description", {
                                uploadJson : '{:U("Do/kind_editor_upload_json")}',
                                fileManagerJson : '../php/file_manager_json.php',           <!-- TODO -->
                                allowFileManager : false                                    <!-- TODO -->
                            });
                        });
                        </script>
                    </p>

                    <p>
                        <label>输入格式</label>
                        <textarea name="input" id="input" rows="10" cols="10"></textarea><br />
                    </p>

                    <p>
                        <label>输出格式</label>
                        <textarea name="output" id="output" rows="10" cols="10"></textarea><br />
                    </p>

                    <p>
                        <label>样例输入</label>
                        <textarea name="sampleinput" id="sampleinput" rows="10" cols="10"></textarea><br />
                    </p>

                    <p>
                        <label>样例输出</label>
                        <textarea name="sampleoutput" id="sampleoutput" rows="10" cols="10"></textarea><br />
                    </p>

                    <p>
                        <label>提示</label>
                        <textarea name="hint" id="hint" rows="10" cols="10"></textarea><br />
                    </p>

                    <p>
                        <label>来源</label>
                        <textarea name="source" id="source" rows="10" cols="10"></textarea><br />
                    </p>

                    <p>
                        <div id="error-tip">
                            <div class="fl">　</div>
                            <div class="fl" id="error-loading"><img src="__ROOT__/default/images/loading.gif" /></div>
                            <div class="fl" id="error-message">不明物体祈祷中...</div>
                            <div class="cl"></div>
                        </div>
                        <input class="button" type="button" id="submit" value="嘛，添加 - -|||" />
                    </p>
                </fieldset>
            </form>
        </div>
    </div>

    <script type="text/javascript">
    /** AJAX 提交的货~ */
    function ajax_submit()
    {
        /** 信息窗 */
        $("#error-tip #error-loading").css("display", "block");
        $("#error-tip #error-message").html("不明物体祈祷中...");
        $("#error-tip").slideDown("normal");

        var json_array = {
            "title" : $("input[name=title]").val(),
            "timelimit" : $("input[name=timelimit]").val(),
            "memorylimit" : $("input[name=memorylimit]").val(),
            "description" : editor.html(),
            "input" : $("textarea[name=input]").val(),
            "output" : $("textarea[name=output]").val(),
            "sampleinput" : $("textarea[name=sampleinput]").val(),
            "sampleoutput" : $("textarea[name=sampleoutput]").val(),
            "hint" : $("textarea[name=hint]").val(),
            "source" : $("textarea[name=source]").val(),
            "{:C('TOKEN_NAME')}" : $("input[name={:C('TOKEN_NAME')}]").val()
        };

        var json_text = JSON.stringify(json_array);

        $.post("{:U('Problem/chkadd')}", { "data" : json_text }, function(html){
            var data = JSON.parse(html);

            $("#error-tip #error-loading").css("display", "none");
            if(data.status == 1)
            {
                $("#error-tip #error-message").html(data.info + ", 正在转向...");
                window.location = "{:U('Problem/catalog')}?page={:Session::get('prob_page_when_back')}";
            }
            else
            {
                $("#error-tip #error-message").html(data.info);
            }
        });
    }

    /** 函数绑定以及其它东西们 */
    $(function(){
        $("#submit").click(function(){
            ajax_submit();
        });

        $("fieldset input").keypress(function(e){
            if(e.keyCode == 13) ajax_submit();
        });
    });
    </script>
<include file="Public:footer" />

