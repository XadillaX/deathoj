<include file="Public:header" />
<link rel="stylesheet" type="text/css" href="__ROOT__/default/css/problem.css" media="screen" />

<script type="text/javascript">
function ajax_submit()
{
    $("#message").html("正在提交...");
    var language = $("select[name=language]").val();
    var id = $("input[name=id]").val();
    var code = $("#code-textarea").val();

    $.post("{:U('Problem/submitok')}", { "language": language, "id": id, "code": code }, function(reply){
        var data = JSON.parse(reply);

        if(data.status == 0)
        {
            $("#message").html(data.info);
            $("input[name=submit]").removeAttr("disable");
        }
        else
        {
            $("#message").html("提交成功，正在转向...");
            window.location = "{:U('Problem/status')}";
        }
    });
}

$(function(){
    $(".titles").click(function(){
        $(this).next().slideToggle("normal");
    });

    $("input[name=submit]").click(function(){
        $("input[name=submit]").attr("disable", "true");
        ajax_submit();
    });
});
</script>

<div id="prob-list-wrapper">
    <ul id="prob-info-ul">
        <li id="title"><h3>提交你的代码</h3></li>
        <li id="limit" style="padding-bottom: 5px;">
            <div style="width: 393px; margin-left: auto; margin-right: auto;">
            <div class="ipt-div fl"><span>题目编号:</span> <input type="text" name="id" value="{$_GET['id']}" /></div>
            <div class="ipt-div fl"><span>语言:</span>
            <select style="width: 60px;" name="language">
                <foreach name="lang_list" item="list">
                    <option value="{$list.languageid}" <if condition="$list['languageid'] eq $current_user['language']">selected="selected"</if>>{$list.language}</option>
                </foreach>
            </select>
            </div>
            <div class="ipt-div fr"><input style="width: 60px;" type="submit" name="submit" value="提交"></div>
            <div class="cl"></div>
            </div>
        </li>

        <li class="titles" id="code-title">代码</li>
        <li class="contents" id="code">
            <div id="code-wrapper">
                <span>{$current_user["username"]} > <span id="message">Paste your code here...</span><span id="cursor_flash">_</span></span><br />
                <textarea rows="10" cols="10" name="code" id="code-textarea"></textarea>
            </div>
        </li>
    </ul>
</div>

<script type="text/javascript">
function cursor_flash()
{
    $("#cursor_flash").fadeToggle("normal");
    setTimeout("cursor_flash()", 500);
}

$(function(){
    cursor_flash();
});
</script>

<include file="Public:footer" />